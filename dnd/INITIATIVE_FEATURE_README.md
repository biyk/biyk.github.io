# Функционал добавления персонажей из других карт инициативы

## Описание

Добавлен новый функционал в таб "Инициатива", который позволяет добавлять персонажей из инициатив других карт в текущую инициативу.

## Новые возможности

### 1. Кнопка "Добавить из другой карты"
- Добавлена новая кнопка рядом с кнопкой "Добавить персонажа"
- При нажатии открывается специальная форма для выбора персонажей из других карт

### 2. Форма выбора карты и персонажей
- **Селект карт**: Выпадающий список всех доступных карт
- **Селект персонажей**: Динамически загружается список персонажей из выбранной карты
- **Кнопка добавления**: "[+] Добавить" для добавления выбранного персонажа

### 3. Автоматическая обработка инициативы
- При добавлении персонажа автоматически генерируется уникальная инициатива
- Если инициатива уже занята, она увеличивается на 0.1 до получения уникального значения
- Все данные персонажа (HP, КД, опыт, статусы) копируются из исходной карты

## Техническая реализация

### Добавленные файлы и изменения:

1. **admin.html** - добавлена HTML структура формы
2. **static/css/styles/init.css** - добавлены стили для новой формы
3. **static/js/init.js** - добавлены новые методы в класс InitiativeManager

### Новые методы в InitiativeManager:

- `toggleAddFromMapsForm()` - переключение видимости формы
- `loadMapsList()` - загрузка списка доступных карт
- `loadCharactersFromMap(mapName)` - загрузка персонажей из выбранной карты
- `addCharacterFromMap()` - добавление персонажа в текущую инициативу

### Обработчики событий:

- Кнопка "Добавить из другой карты"
- Изменение выбора карты в селекте
- Кнопка добавления персонажа

## Использование

1. Откройте таб "Инициатива"
2. Нажмите кнопку "Добавить из другой карты"
3. Выберите карту из выпадающего списка
4. Выберите персонажа из появившегося списка
5. Нажмите "[+] Добавить"
6. Персонаж будет добавлен в текущую инициативу с уникальной инициативой

## Тестирование

Созданы два тестовых файла:

1. **test_initiative.html** - полный тест с реальными модулями
2. **test_initiative_simple.html** - упрощенный тест без внешних зависимостей

Для тестирования откройте любой из этих файлов в браузере.

## Особенности

- Форма автоматически скрывается после добавления персонажа
- Все персонажи сортируются по инициативе (от высшей к низшей)
- Поддерживается копирование всех свойств персонажа
- Обработка ошибок с информативными сообщениями
- Совместимость с существующей системой инициативы

## Требования

- Работает только в режиме администратора (admin_mode)
- Требует доступ к Google Sheets API
- Необходимы соответствующие права доступа к таблицам карт
